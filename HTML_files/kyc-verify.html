<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identity Verification - UNERA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --earth-deep: #2C5F2D;
            --earth-rich: #4A7C59;
            --earth-fresh: #7FA99B;
            --sky-vibrant: #0EA5E9;
            --sun-warm: #F59E0B;
            --bloom-hope: #EC4899;
            --stone-dark: #1F2937;
            --stone-medium: #6B7280;
            --stone-light: #F3F4F6;
            --stone-white: #FFFFFF;
            --impact-green: #10B981;
            --alert-orange: #F97316;
            --trust-blue: #3B82F6;
            --gradient-earth: linear-gradient(135deg, #2C5F2D 0%, #7FA99B 100%);
            --gradient-sky: linear-gradient(135deg, #0EA5E9 0%, #3B82F6 100%);
            --gradient-impact: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%);
            --font-display: 'Space Grotesk', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header */
        .header {
            padding: 1.375rem 2.75rem;
            background: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.688rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
        }

        .logo-text {
            font-family: var(--font-display);
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--stone-dark);
            letter-spacing: -0.02em;
        }

        .exit-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.688rem 1.375rem;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 0.75rem;
            font-family: var(--font-body);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--stone-dark);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .exit-btn:hover {
            background: var(--stone-light);
        }

        /* Main Container */
        .main-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2.75rem 1.375rem;
            min-height: calc(100vh - 100px);
        }

        /* Intro Section */
        .intro-section {
            background: white;
            border-radius: 1.25rem;
            padding: 3.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .intro-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 2rem;
            font-size: 0.813rem;
            font-weight: 600;
            color: var(--impact-green);
            margin-bottom: 1.5rem;
        }

        .intro-icon {
            width: 96px;
            height: 96px;
            margin: 0 auto 1.5rem;
            background: var(--gradient-impact);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 12px 40px rgba(16, 185, 129, 0.4);
            }
        }

        .intro-icon svg {
            width: 48px;
            height: 48px;
            stroke: white;
            stroke-width: 2;
        }

        .intro-title {
            font-family: var(--font-display);
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--stone-dark);
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .intro-subtitle {
            font-size: 1.125rem;
            color: var(--stone-medium);
            margin-bottom: 2.5rem;
            line-height: 1.6;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%);
            border-radius: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 0.75rem;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .stat-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--impact-green);
            stroke-width: 2;
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--stone-dark);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--stone-medium);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            text-align: left;
            margin-bottom: 2.5rem;
        }

        @media (max-width: 900px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .intro-section .preview-grid {
                grid-template-columns: 1fr !important;
            }
        }

        .feature-card {
            padding: 1.5rem;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 0.875rem;
            transition: all 0.2s;
        }

        .feature-card:hover {
            border-color: var(--impact-green);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.1);
            transform: translateY(-2px);
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: var(--impact-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .radio-option input[type="radio"]:checked + div {
            font-weight: 600;
        }

        .radio-option:has(input[type="radio"]:checked) {
            border-color: var(--impact-green);
            background: rgba(16, 185, 129, 0.1);
        }

        /* Flow animations & polish */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes checkmark {
            0% { transform: scale(0) rotate(-45deg); }
            50% { transform: scale(1.2) rotate(-45deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .flow-card-animated {
            animation: slideIn 0.4s ease-out;
        }

        #kycFlowContainer {
            margin: 0 auto;
        }

        body {
            overflow-x: hidden;
        }

        .main-container {
            max-width: 100%;
            overflow-x: hidden;
        }

        .success-icon-animated {
            animation: checkmark 0.5s ease-out;
        }

        .capture-frame {
            transition: all 0.3s ease;
        }

        .capture-frame:hover {
            transform: scale(1.02);
        }

        .progress-shimmer {
            position: relative;
            overflow: hidden;
        }

        .progress-shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }

        @keyframes scanLine {
            0%, 100% { transform: translateY(0); opacity: 0.8; }
            50% { transform: translateY(260px); opacity: 0.3; }
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-impact);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .feature-icon svg {
            width: 20px;
            height: 20px;
            stroke: white;
            stroke-width: 2.5;
        }

        .feature-title {
            font-weight: 600;
            color: var(--stone-dark);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .feature-desc {
            font-size: 0.875rem;
            color: var(--stone-medium);
            line-height: 1.6;
        }

        .unlock-box {
            position: relative;
            background: 
                linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(14, 165, 233, 0.08) 100%),
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(16, 185, 129, 0.03) 10px, rgba(16, 185, 129, 0.03) 20px);
            border: 2px solid rgba(16, 185, 129, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .unlock-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--stone-dark);
            margin-bottom: 1.25rem;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .unlock-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            position: relative;
            z-index: 2;
        }

        .unlock-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-radius: 0.75rem;
        }
        
        .unlock-item span {
            font-size: 0.813rem;
            line-height: 1.4;
        }
        
        /* Floating shapes for unlock box */
        .unlock-floating {
            position: absolute;
            animation: gentle-float 10s infinite ease-in-out;
            pointer-events: none;
            z-index: 1;
        }
        
        .unlock-floating:nth-child(1) { left: 5%; top: 15%; animation-delay: 0s; animation-duration: 9s; }
        .unlock-floating:nth-child(2) { left: 20%; top: 60%; animation-delay: 2s; animation-duration: 11s; }
        .unlock-floating:nth-child(3) { left: 35%; top: 25%; animation-delay: 4s; animation-duration: 10s; }
        .unlock-floating:nth-child(4) { left: 50%; top: 70%; animation-delay: 1s; animation-duration: 12s; }
        .unlock-floating:nth-child(5) { left: 65%; top: 20%; animation-delay: 6s; animation-duration: 8s; }
        .unlock-floating:nth-child(6) { left: 80%; top: 55%; animation-delay: 3s; animation-duration: 13s; }
        .unlock-floating:nth-child(7) { left: 90%; top: 35%; animation-delay: 8s; animation-duration: 10s; }
        .unlock-floating:nth-child(8) { left: 10%; top: 80%; animation-delay: 5s; animation-duration: 14s; }
        
        @keyframes gentle-float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(0.8);
                opacity: 0.1;
            }
            25% {
                transform: translate(15px, -20px) rotate(90deg) scale(1);
                opacity: 0.15;
            }
            50% {
                transform: translate(-10px, -30px) rotate(180deg) scale(0.9);
                opacity: 0.12;
            }
            75% {
                transform: translate(20px, -15px) rotate(270deg) scale(1.05);
                opacity: 0.08;
            }
        }

        .unlock-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            stroke: var(--impact-green);
            stroke-width: 2.5;
        }

        .unlock-item span {
            font-size: 0.938rem;
            color: var(--stone-dark);
            font-weight: 500;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: var(--gradient-impact);
            color: white;
            padding: 1.125rem 3rem;
            font-size: 1.063rem;
            font-weight: 600;
            border: none;
            border-radius: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
        }

        .btn-primary svg {
            width: 18px;
            height: 18px;
        }

        .btn-secondary {
            background: white;
            color: var(--stone-dark);
            padding: 1.125rem 2rem;
            font-size: 0.938rem;
            font-weight: 600;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            border-color: var(--stone-medium);
        }

        .privacy-notice {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--stone-light);
            border-radius: 0.875rem;
            font-size: 0.813rem;
            color: var(--stone-medium);
            line-height: 1.6;
            text-align: left;
            display: flex;
            align-items: start;
            gap: 1rem;
        }

        .privacy-notice svg {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            stroke: var(--impact-green);
            stroke-width: 2;
            margin-top: 2px;
        }

        .privacy-notice a {
            color: var(--impact-green);
            text-decoration: none;
            font-weight: 600;
        }

        .privacy-notice a:hover {
            text-decoration: underline;
        }

        /* Verification Container (Sumsub SDK) */
        .verification-container {
            background: white;
            border-radius: 1.25rem;
            padding: 3.5rem 2rem;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        .verification-container.active {
            display: block;
        }

        .verification-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .verification-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--stone-dark);
            margin-bottom: 0.5rem;
        }

        .verification-subtitle {
            font-size: 1rem;
            color: var(--stone-medium);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 0, 0, 0.06);
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-impact);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Sumsub Container */
        #sumsub-websdk-container {
            width: 100%;
            min-height: 600px;
            border-radius: 0.875rem;
            overflow: hidden;
        }

        .loading-state {
            text-align: center;
            padding: 3rem;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(16, 185, 129, 0.1);
            border-top-color: var(--impact-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--stone-medium);
            font-size: 0.938rem;
        }

        /* Status Section */
        .status-section {
            background: white;
            border-radius: 1.25rem;
            padding: 3.5rem;
            text-align: center;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        .status-section.active {
            display: block;
        }

        .status-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: successPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes successPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .status-icon.success {
            background: var(--gradient-impact);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        .status-icon.pending {
            background: linear-gradient(135deg, #F59E0B 0%, #EAB308 100%);
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.3);
        }

        .status-icon.error {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3);
        }

        .status-icon svg {
            width: 60px;
            height: 60px;
            stroke: white;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .status-title {
            font-family: var(--font-display);
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--stone-dark);
            margin-bottom: 1rem;
        }

        .status-message {
            font-size: 1.125rem;
            color: var(--stone-medium);
            margin-bottom: 2rem;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .status-details {
            background: var(--stone-light);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .status-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }

        .status-detail-row:last-child {
            border-bottom: none;
        }

        .status-detail-label {
            color: var(--stone-medium);
            font-size: 0.938rem;
        }

        .status-detail-value {
            color: var(--stone-dark);
            font-weight: 600;
            font-size: 0.938rem;
        }

        .info-box {
            background: rgba(16, 185, 129, 0.05);
            border-left: 4px solid var(--impact-green);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 2rem auto;
            text-align: left;
            max-width: 600px;
        }

        .info-box-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .info-box-header svg {
            width: 20px;
            height: 20px;
            stroke: var(--impact-green);
            stroke-width: 2;
            flex-shrink: 0;
        }

        .info-box-title {
            font-weight: 700;
            color: var(--stone-dark);
            font-size: 1rem;
        }

        .info-box-content {
            font-size: 0.875rem;
            color: var(--stone-dark);
            line-height: 1.6;
        }

        .info-box-content ul {
            list-style: none;
            padding: 0;
            margin: 0.5rem 0 0 0;
        }

        .info-box-content li {
            padding: 0.25rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .info-box-content li:before {
            content: "â€¢";
            position: absolute;
            left: 0.5rem;
            color: var(--impact-green);
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1rem 1.375rem;
            }

            .main-container {
                padding: 1.375rem;
            }

            .intro-section,
            .verification-container,
            .status-section {
                padding: 2rem 1.5rem;
            }

            .intro-title,
            .status-title {
                font-size: 1.75rem;
            }

            .stats-grid,
            .features-grid,
            .unlock-list {
                grid-template-columns: 1fr;
            }

            .cta-buttons {
                flex-direction: column;
                width: 100%;
            }

            .btn-primary,
            .btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <svg class="logo-icon" viewBox="0 0 140 140">
                <circle cx="70" cy="70" r="60" fill="#99F6E4"/>
                <circle cx="70" cy="70" r="45" fill="#14B8A6"/>
                <circle cx="70" cy="70" r="30" fill="#0F766E"/>
                <circle cx="70" cy="70" r="15" fill="#FFFFFF"/>
            </svg>
            <span class="logo-text">UNERA</span>
        </div>
        <a href="dashboard-enhanced.html" class="exit-btn">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Exit
        </a>
    </header>

    <div class="main-container">
        <!-- Intro Section -->
        <div class="intro-section" id="introSection">

            <div class="intro-icon">
                <svg fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
            </div>

            <h1 class="intro-title">Verify Your Identity</h1>
            <p class="intro-subtitle">
                One-time verification, infinite journeys. Complete your identity verification once with Sumsub, and enjoy seamless access across the UNERA ecosystem.
            </p>

            <div style="text-align: center; margin-bottom: 2.5rem;">
                <button class="btn-primary" onclick="startVerification()" style="padding: 1rem 2.5rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
                    Start Verification
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="stat-value">5 min</div>
                    <div class="stat-label">Average time</div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div class="stat-value">95%</div>
                    <div class="stat-label">Instant approval</div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                    </div>
                    <div class="stat-value">256-bit</div>
                    <div class="stat-label">Encryption</div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </div>
                    <div class="feature-title">Reusable Identity</div>
                    <div class="feature-desc">Verify once, use everywhere. Your identity data can be securely shared across partner platforms.</div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="feature-title">Quick Liveness Check</div>
                    <div class="feature-desc">If you've verified before with a partner, only a quick liveness check is neededâ€”no document upload.</div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <div class="feature-title">Full Compliance</div>
                    <div class="feature-desc">All verifications meet complete KYC requirements. Missing info? You'll be prompted automatically.</div>
                </div>
            </div>

            <div class="unlock-box">
                <!-- Floating shapes -->
                <div class="unlock-floating">
                    <svg width="32" height="32" viewBox="0 0 140 140"><circle cx="70" cy="70" r="60" fill="#99F6E4"/><circle cx="70" cy="70" r="45" fill="#14B8A6"/><circle cx="70" cy="70" r="30" fill="#0F766E"/><circle cx="70" cy="70" r="15" fill="#FFF"/></svg>
                </div>
                <div class="unlock-floating">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#0EA5E9"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                </div>
                <div class="unlock-floating">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#EC4899"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <div class="unlock-floating">
                    <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%);"></div>
                </div>
                <div class="unlock-floating">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="#F59E0B"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                </div>
                <div class="unlock-floating">
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="#10B981"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <div class="unlock-floating">
                    <svg width="18" height="18" viewBox="0 0 140 140"><circle cx="70" cy="70" r="60" fill="#99F6E4"/><circle cx="70" cy="70" r="45" fill="#14B8A6"/><circle cx="70" cy="70" r="30" fill="#0F766E"/><circle cx="70" cy="70" r="15" fill="#FFF"/></svg>
                </div>
                <div class="unlock-floating">
                    <div style="width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, #0EA5E9 0%, #3B82F6 100%);"></div>
                </div>
                
                <div class="unlock-title">âœ¨ What You'll Unlock</div>
                <div class="unlock-list">
                    <div class="unlock-item">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Donate to Humanity Centres (up to $1,000/month)</span>
                    </div>
                    <div class="unlock-item">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Purchase stablecoins (hCAD, hUSD, hEUR)</span>
                    </div>
                    <div class="unlock-item">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Send funds globally with low fees</span>
                    </div>
                    <div class="unlock-item">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Full dashboard access & impact tracking</span>
                    </div>
                </div>
            </div>

            <div class="cta-buttons">
                <button class="btn-primary" onclick="startVerification()">
                    Start Verification
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                    </svg>
                </button>
                <a href="dashboard-enhanced.html" class="btn-secondary">I'll do this later</a>
            </div>

            <div class="privacy-notice">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                <div>
                    <strong>Your privacy matters.</strong> We partner with <a href="https://sumsub.com/reusable-kyc/" target="_blank" rel="noopener">Sumsub</a>, a trusted identity verification provider used by leading financial institutions worldwide. Your data is encrypted (256-bit SSL), never shared without consent, and stored securely in compliance with GDPR, CCPA, and global regulations. Read our <a href="#">Privacy Policy</a> and <a href="#">Data Protection</a> practices.
                </div>
            </div>

            <!-- Testing Helper (Demo Mode Only) -->
            <div style="margin-top: 2rem; padding: 1rem; background: rgba(14, 165, 233, 0.05); border: 1px dashed rgba(14, 165, 233, 0.3); border-radius: 0.75rem; text-align: center;">
                <div style="font-size: 0.813rem; color: var(--stone-medium); margin-bottom: 0.75rem;">
                    <strong>ðŸ§ª Demo Mode:</strong> Test both verification paths
                </div>
                <div style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; font-size: 0.813rem;">
                    <button onclick="testAsNewUser()" style="padding: 0.75rem 1.25rem; background: white; border: 1px solid rgba(0,0,0,0.12); border-radius: 0.75rem; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.08);" onmouseover="this.style.borderColor='rgba(16, 185, 129, 0.5)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.15)';" onmouseout="this.style.borderColor='rgba(0,0,0,0.12)'; this.style.boxShadow='0 1px 3px rgba(0,0,0,0.08)';">
                        Test as New User (Full KYC)
                    </button>
                    <button onclick="testAsReturningUser()" style="padding: 0.75rem 1.25rem; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); color: white; border: none; border-radius: 0.75rem; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 16px rgba(16, 185, 129, 0.35)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(16, 185, 129, 0.25)';">
                        Test as Returning User (Quick Liveness)
                    </button>
                    <button onclick="clearTestData()" style="padding: 0.5rem 1rem; background: white; border: 1px solid rgba(0,0,0,0.1); border-radius: 0.5rem; cursor: pointer; font-weight: 500; color: var(--alert-orange);">
                        Clear Test Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Verification Container (Sumsub SDK) -->
        <div class="verification-container" id="verificationContainer">
            <div class="verification-header">
                <h2 class="verification-title">Identity Verification</h2>
                <p class="verification-subtitle">Please complete the verification process below</p>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <div class="loading-text">Initializing Sumsub verification...</div>
            </div>

            <div id="sumsub-websdk-container"></div>
        </div>

        <!-- Status Section -->
        <div class="status-section" id="statusSection">
            <!-- Content will be dynamically inserted -->
        </div>
    </div>

    <!-- Sumsub Web SDK (Commented for demo) -->
    <!-- <script src="https://static.sumsub.com/idensic/static/sns-websdk-builder.js"></script> -->

    <script>
        let snsWebSdkInstance = null;
        let currentStep = 0;
        const DEMO_MODE = true; // Set to false when you have real Sumsub API keys

        // Start verification flow
        function startVerification() {
            // Check if user has reusable KYC or is new
            const hasReusableKYC = checkReusableKYC();
            
            // Hide intro
            document.getElementById('introSection').style.display = 'none';
            
            // 50% chance of error on first try (DEMO MODE)
            const shouldError = DEMO_MODE && Math.random() > 0.5;
            
            if (shouldError) {
                // Show error screen
                document.getElementById('verificationContainer').classList.add('active');
                setTimeout(() => {
                    simulateError();
                }, 1000);
            } else {
                // Launch detailed flow
                startVerificationFlow(hasReusableKYC ? 'returning' : 'new');
            }
        }

        // Simulate complete KYC flow following Sumsub Reusable KYC steps
        function simulateKYCFlow() {
            // STEP 1: Set up - Check if user has reusable KYC from partners
            const hasReusableKYC = checkReusableKYC();
            
            let steps;
            
            if (hasReusableKYC) {
                // RETURNING USER: Only liveness check needed (Sumsub benefit!)
                steps = [
                    { 
                        name: 'ðŸ” Checking partner network', 
                        progress: 15, 
                        duration: 1200,
                        description: 'Found previous verification with partner platform'
                    },
                    { 
                        name: 'âœ… Reusable KYC detected', 
                        progress: 30, 
                        duration: 800,
                        description: 'No document upload needed'
                    },
                    { 
                        name: 'ðŸ¤³ Quick liveness check', 
                        progress: 60, 
                        duration: 2000,
                        description: 'Please look at camera and follow instructions'
                    },
                    { 
                        name: 'ðŸ”’ Compliance validation', 
                        progress: 85, 
                        duration: 1500,
                        description: 'Running automatic compliance checks'
                    },
                    { 
                        name: 'âœ¨ Finalizing', 
                        progress: 95, 
                        duration: 800,
                        description: 'Almost done...'
                    }
                ];
            } else {
                // NEW USER: Full verification process
                steps = [
                    { 
                        name: 'ðŸ” Checking partner network', 
                        progress: 10, 
                        duration: 1000,
                        description: 'No previous verification found'
                    },
                    { 
                        name: 'ðŸ“‹ Select document type', 
                        progress: 20, 
                        duration: 1500,
                        description: 'Choose: Passport, ID Card, or Driver License'
                    },
                    { 
                        name: 'ðŸ“¸ Upload document (front)', 
                        progress: 35, 
                        duration: 2000,
                        description: 'Ensure all 4 corners are visible'
                    },
                    { 
                        name: 'ðŸ“¸ Upload document (back)', 
                        progress: 50, 
                        duration: 1800,
                        description: 'Good lighting, no glare'
                    },
                    { 
                        name: 'ðŸ¤³ Take selfie', 
                        progress: 65, 
                        duration: 2000,
                        description: 'Remove glasses, look at camera'
                    },
                    { 
                        name: 'ðŸ˜Š Liveness detection', 
                        progress: 75, 
                        duration: 2500,
                        description: 'Smile, blink, turn head left/right'
                    },
                    { 
                        name: 'ðŸ”’ Compliance checks', 
                        progress: 90, 
                        duration: 1500,
                        description: 'AML screening, document validation, face matching'
                    },
                    { 
                        name: 'âœ¨ Finalizing', 
                        progress: 95, 
                        duration: 1000,
                        description: 'Processing results...'
                    }
                ];
            }

            let currentStepIndex = 0;

            function nextStep() {
                if (currentStepIndex >= steps.length) {
                    // Final step - random outcome (weighted toward success)
                    const outcomes = ['success', 'success', 'success', 'pending', 'rejected'];
                    const randomOutcome = outcomes[Math.floor(Math.random() * outcomes.length)];
                    
                    setTimeout(() => {
                        document.getElementById('progressBar').style.width = '100%';
                        if (randomOutcome === 'rejected') {
                            showStatus('rejected', {
                                reviewResult: {
                                    rejectLabels: ['BLURRY_DOCUMENT', 'POOR_LIGHTING', 'EXPIRED_DOCUMENT'][Math.floor(Math.random() * 3)]
                                }
                            });
                        } else {
                            showStatus(randomOutcome, { hasReusableKYC });
                            if (randomOutcome === 'success') {
                                updateKYCStatus('verified');
                            }
                        }
                    }, 800);
                    return;
                }

                const step = steps[currentStepIndex];
                document.getElementById('progressBar').style.width = step.progress + '%';
                
                // Update loading state with step name and description
                const loadingState = document.getElementById('loadingState');
                loadingState.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div class="loading-text" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.5rem;">
                        ${step.name}
                    </div>
                    <div class="loading-text" style="font-size: 0.875rem; color: var(--stone-medium);">
                        ${step.description}
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.813rem; color: var(--impact-green);">
                        Step ${currentStepIndex + 1} of ${steps.length}
                    </div>
                `;

                setTimeout(() => {
                    currentStepIndex++;
                    nextStep();
                }, step.duration);
            }

            document.getElementById('loadingState').style.display = 'block';
            
            // Show which flow is being used
            if (hasReusableKYC) {
                document.getElementById('verificationContainer').querySelector('.verification-subtitle').innerHTML = 
                    'âœ¨ <strong style="color: var(--impact-green);">Reusable KYC Detected!</strong> Quick liveness check only - no document upload needed.';
            } else {
                document.getElementById('verificationContainer').querySelector('.verification-subtitle').textContent = 
                    'First-time verification - please have your ID document ready';
            }
            
            nextStep();
        }

        // Check if user has reusable KYC from partner platforms
        function checkReusableKYC() {
            // Check localStorage for previous verification
            const previousVerification = localStorage.getItem('reusableKYCPartner');
            
            // 40% chance user has verified with a partner before (realistic simulation)
            // In production, this would be an API call to check partner network
            if (previousVerification) {
                return true;
            }
            
            // Simulate checking partner network
            const hasPartnerVerification = Math.random() > 0.6; // 40% have reusable KYC
            
            if (hasPartnerVerification) {
                // Simulate partner platforms
                const partners = ['CryptoExchange', 'DigitalWallet', 'TradingPlatform', 'FinTechApp'];
                const randomPartner = partners[Math.floor(Math.random() * partners.length)];
                localStorage.setItem('reusableKYCPartner', randomPartner);
                console.log('â™»ï¸ Reusable KYC found from:', randomPartner);
            }
            
            return hasPartnerVerification;
        }

        // Simulate error (50% of attempts)
        function simulateError() {
            document.getElementById('progressBar').style.width = '15%';
            setTimeout(() => {
                showStatus('error', { 
                    message: 'Network connection timeout. Please check your internet and try again.' 
                });
            }, 1000);
        }

        // Initialize Sumsub SDK with Reusable KYC configuration (Real implementation)
        function initializeSumsubSDK() {
            try {
                // Check if Sumsub SDK is loaded
                if (typeof idensic === 'undefined') {
                    throw new Error('Sumsub SDK not loaded');
                }

                // In production, get this token from your backend API
                // POST /api/kyc/init â†’ returns { accessToken, applicantId }
                const accessToken = generateAccessToken();
                
                // Update progress
                document.getElementById('progressBar').style.width = '30%';
                
                // Configure and build Sumsub SDK
                snsWebSdkInstance = idensic
                    .init(
                        accessToken,
                        // Token refresh callback
                        () => Promise.resolve(generateAccessToken())
                    )
                    .withConf({
                        lang: 'en',
                        theme: 'light',
                        email: getUserEmail(),
                        phone: getUserPhone(),
                        uiConf: {
                            customCss: `
                                /* Sumsub SDK Custom Branding */
                                .main-container {
                                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;
                                }
                                .step-header {
                                    font-family: 'Space Grotesk', sans-serif !important;
                                    font-weight: 700 !important;
                                }
                                .button-primary {
                                    background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%) !important;
                                    border-radius: 0.875rem !important;
                                    font-weight: 600 !important;
                                    transition: all 0.2s !important;
                                }
                                .button-primary:hover {
                                    transform: translateY(-2px) !important;
                                    box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4) !important;
                                }
                            `
                        }
                    })
                    .withOptions({ 
                        addViewportTag: false, 
                        adaptIframeHeight: true 
                    })
                    // Event listeners
                    .on('idCheck.onStepCompleted', (payload) => {
                        console.log('âœ… Step completed:', payload);
                        updateProgress(payload);
                    })
                    .on('idCheck.onError', (error) => {
                        console.error('âŒ Verification error:', error);
                        showStatus('error', { message: error.message });
                    })
                    .on('idCheck.onApplicantSubmitted', (payload) => {
                        console.log('ðŸ“¤ Applicant submitted:', payload);
                        document.getElementById('progressBar').style.width = '90%';
                        showStatus('pending');
                    })
                    .on('idCheck.onApplicantReviewed', (payload) => {
                        console.log('ðŸ” Applicant reviewed:', payload);
                        const reviewResult = payload.reviewResult?.reviewAnswer;
                        
                        document.getElementById('progressBar').style.width = '100%';
                        
                        if (reviewResult === 'GREEN') {
                            // Approved
                            showStatus('success');
                            updateKYCStatus('verified');
                        } else if (reviewResult === 'RED') {
                            // Rejected
                            showStatus('rejected', payload);
                        } else {
                            // Manual review / pending
                            showStatus('pending');
                        }
                    })
                    .on('idCheck.onApplicantLoaded', (payload) => {
                        console.log('ðŸ‘¤ Applicant loaded:', payload);
                        // Check if reusable KYC data exists
                        if (payload.reusableKYC && payload.reusableKYC.verified) {
                            console.log('â™»ï¸ Reusable KYC detected - Quick liveness check only');
                            document.getElementById('loadingState').querySelector('.loading-text').textContent = 
                                'Previous verification found! Quick liveness check required...';
                        }
                    })
                    .build();

                // Launch the SDK
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('progressBar').style.width = '50%';
                
                snsWebSdkInstance
                    .launch('#sumsub-websdk-container')
                    .then(() => {
                        console.log('âœ… Sumsub SDK launched successfully');
                        document.getElementById('loadingState').style.display = 'none';
                        document.getElementById('progressBar').style.width = '60%';
                    })
                    .catch((error) => {
                        console.error('âŒ SDK launch failed:', error);
                        showStatus('error', { message: 'Failed to load verification widget. Please check your connection.' });
                    });

            } catch (error) {
                console.error('âŒ SDK initialization failed:', error);
                showStatus('error', { message: 'Sumsub SDK not available. Using demo mode.' });
            }
        }

        // Update progress based on steps
        function updateProgress(payload) {
            const step = payload.step;
            const progressMap = {
                'email': 65,
                'phone': 70,
                'documents': 75,
                'selfie': 85,
                'liveness': 90
            };
            
            const progress = progressMap[step] || 60;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Generate access token (mock for demo - replace with backend API call)
        function generateAccessToken() {
            // In production, call your backend:
            // const response = await fetch('/api/kyc/init', { 
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ userId: getCurrentUserId() })
            // });
            // const data = await response.json();
            // return data.accessToken;
            
            return 'DEMO_ACCESS_TOKEN_' + Date.now();
        }

        // Get user email from session/localStorage
        function getUserEmail() {
            return localStorage.getItem('userEmail') || '';
        }

        // Get user phone from session/localStorage
        function getUserPhone() {
            return localStorage.getItem('userPhone') || '';
        }

        // Show status screen
        function showStatus(status, data = {}) {
            // Hide verification container
            document.getElementById('verificationContainer').classList.remove('active');
            
            // Show status section
            const statusSection = document.getElementById('statusSection');
            statusSection.classList.add('active');

            let content = '';

            if (status === 'success') {
                const usedReusableKYC = data.hasReusableKYC || localStorage.getItem('reusableKYCPartner');
                const verificationType = usedReusableKYC ? 'Quick Liveness Check' : 'Full Document Verification';
                const verificationTime = usedReusableKYC ? '~2 minutes' : '~5 minutes';
                
                content = `
                    <div class="status-icon success">
                        <svg viewBox="0 0 24 24">
                            <path d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <h1 class="status-title">Verification Successful!</h1>
                    <p class="status-message">
                        ${usedReusableKYC 
                            ? 'ðŸŽ‰ Your identity was verified using <strong>Reusable KYC</strong>! Since you\'ve verified with a partner before, we only needed a quick liveness check.' 
                            : 'Your identity has been verified. You can now access all features of UNERA and enjoy seamless onboarding across our partner ecosystem.'}
                    </p>
                    <div class="status-details">
                        <div class="status-detail-row">
                            <span class="status-detail-label">Status</span>
                            <span class="status-detail-value" style="color: var(--impact-green);">âœ“ Verified</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Verification Type</span>
                            <span class="status-detail-value">${verificationType}</span>
                        </div>
                        ${usedReusableKYC ? `
                        <div class="status-detail-row">
                            <span class="status-detail-label">Partner Platform</span>
                            <span class="status-detail-value">${localStorage.getItem('reusableKYCPartner') || 'Partner Network'}</span>
                        </div>` : ''}
                        <div class="status-detail-row">
                            <span class="status-detail-label">Completion Time</span>
                            <span class="status-detail-value">${verificationTime}</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Verification Level</span>
                            <span class="status-detail-value">Basic (Tier 1)</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Monthly Transaction Limit</span>
                            <span class="status-detail-value">$1,000</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Verified On</span>
                            <span class="status-detail-value">${new Date().toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Reusable KYC</span>
                            <span class="status-detail-value" style="color: var(--impact-green);">âœ“ Enabled</span>
                        </div>
                    </div>
                    <div class="info-box">
                        <div class="info-box-header">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                            </svg>
                            <div class="info-box-title">${usedReusableKYC ? 'Reusable KYC Benefit' : 'Your Reusable KYC is Now Active'}</div>
                        </div>
                        <div class="info-box-content">
                            ${usedReusableKYC 
                                ? '<strong>You just experienced Reusable KYC!</strong> Because you verified with a partner platform, we only needed a quick liveness check instead of full document upload. This saved you time and reduced friction.<br><br>Your verified identity will continue to work across our partner ecosystem.' 
                                : 'Your verified identity can now be shared securely across partner platforms. <strong>Next time you onboard with a partner service, you\'ll only need a quick liveness checkâ€”no document upload required!</strong> This makes future verifications 60% faster.'}
                        </div>
                    </div>
                    <div class="action-buttons">
                        <a href="dashboard-enhanced.html" class="btn-primary">
                            Go to Dashboard
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                            </svg>
                        </a>
                        <a href="donate.html" class="btn-secondary">Make Your First Donation</a>
                    </div>
                `;
            } else if (status === 'pending') {
                content = `
                    <div class="status-icon pending">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                    </div>
                    <h1 class="status-title">Verification Submitted</h1>
                    <p class="status-message">
                        Thank you for completing the verification process! Your documents are being reviewed by our compliance team. Most verifications are completed within 1-24 hours.
                    </p>
                    <div class="status-details">
                        <div class="status-detail-row">
                            <span class="status-detail-label">Status</span>
                            <span class="status-detail-value" style="color: var(--sun-warm);">â³ Under Review</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Submitted</span>
                            <span class="status-detail-value">${new Date().toLocaleString('en-US', { 
                                dateStyle: 'medium', 
                                timeStyle: 'short' 
                            })}</span>
                        </div>
                        <div class="status-detail-row">
                            <span class="status-detail-label">Estimated Review Time</span>
                            <span class="status-detail-value">1-24 hours</span>
                        </div>
                    </div>
                    <div class="info-box">
                        <div class="info-box-header">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="info-box-title">What Happens Next?</div>
                        </div>
                        <div class="info-box-content">
                            <ul>
                                <li>Our compliance team will review your submitted documents</li>
                                <li>You'll receive an email notification when verification is complete</li>
                                <li>You can check your verification status anytime in your dashboard</li>
                                <li>Once approved, your Reusable KYC will be activated automatically</li>
                            </ul>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <a href="dashboard-enhanced.html" class="btn-primary">Go to Dashboard</a>
                    </div>
                `;
            } else if (status === 'rejected') {
                const rejectReason = data.reviewResult?.rejectLabels?.[0] || 'Document quality issue';
                const reasonMessages = {
                    'BLURRY_DOCUMENT': 'Document is unclear or blurry',
                    'EXPIRED_DOCUMENT': 'ID document has expired',
                    'INCOMPLETE_DOCUMENT': 'Missing document sides or information',
                    'POOR_LIGHTING': 'Photo taken in poor lighting conditions',
                    'NAME_MISMATCH': 'Name doesn\'t match account information',
                    'FACE_MISMATCH': 'Selfie doesn\'t match ID photo'
                };
                const friendlyReason = reasonMessages[rejectReason] || rejectReason;
                
                content = `
                    <div class="status-icon error">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M15 9l-6 6M9 9l6 6"/>
                        </svg>
                    </div>
                    <h1 class="status-title">Verification Incomplete</h1>
                    <p class="status-message">
                        We couldn't complete your verification with the information provided. Please review the issue below and try again.
                    </p>
                    <div class="status-details">
                        <div class="status-detail-row">
                            <span class="status-detail-label">Issue Detected</span>
                            <span class="status-detail-value" style="color: var(--alert-orange);">${friendlyReason}</span>
                        </div>
                    </div>
                    <div class="info-box" style="background: rgba(239, 68, 68, 0.05); border-left-color: #EF4444;">
                        <div class="info-box-header">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="stroke: #EF4444;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            <div class="info-box-title">Tips for Successful Verification</div>
                        </div>
                        <div class="info-box-content">
                            <ul>
                                <li>Use good natural or bright lighting</li>
                                <li>Ensure all 4 corners of your document are visible</li>
                                <li>Check that your ID is current and not expired</li>
                                <li>Hold your camera steady to avoid blur</li>
                                <li>Remove glasses or hat for selfie photos</li>
                                <li>Make sure the document matches your account name</li>
                            </ul>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="location.reload()">
                            Try Again
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                        </button>
                        <a href="dashboard-enhanced.html" class="btn-secondary">Go to Dashboard</a>
                    </div>
                `;
            } else if (status === 'error') {
                content = `
                    <div class="status-icon error">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 8v4m0 4h.01"/>
                        </svg>
                    </div>
                    <h1 class="status-title">Something Went Wrong</h1>
                    <p class="status-message">
                        We encountered an error during the verification process: ${data.message || 'Unknown error'}. Please try again or contact support if the problem persists.
                    </p>
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="location.reload()">Try Again</button>
                        <a href="dashboard-enhanced.html" class="btn-secondary">Go to Dashboard</a>
                    </div>
                `;
            }

            statusSection.innerHTML = content;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update KYC status in localStorage
        function updateKYCStatus(status) {
            localStorage.setItem('kycStatus', status);
            localStorage.setItem('kycLevel', 'tier1');
            localStorage.setItem('kycVerifiedDate', new Date().toISOString());
            localStorage.setItem('reusableKYC', 'enabled');
            
            // In production, also update backend via API
            // fetch('/api/kyc/update', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ status, level: 'tier1', reusableKYC: true })
            // });
            
            console.log('âœ… KYC status updated:', {
                status,
                level: 'tier1',
                date: new Date().toISOString(),
                reusableKYC: true
            });
        }

        // Check if already verified (redirect to dashboard)
        window.addEventListener('DOMContentLoaded', () => {
            const kycStatus = localStorage.getItem('kycStatus');
            
            if (kycStatus === 'verified') {
                // Already verified, show success message or redirect
                console.log('â„¹ï¸ User already verified');
                // Optionally redirect immediately or show success screen
                // window.location.href = 'dashboard-enhanced.html?message=already_verified';
            }
            
            console.log('âœ… KYC verification page loaded');
            console.log('ðŸ“Š Current KYC status:', kycStatus || 'not_started');
            
            // Show current test mode
            const hasReusableKYC = localStorage.getItem('reusableKYCPartner');
            if (hasReusableKYC) {
                console.log('â™»ï¸ Testing as RETURNING user (Reusable KYC from:', hasReusableKYC + ')');
            } else {
                console.log('ðŸ†• Testing as NEW user (Full verification required)');
            }
            
            // Flow testing guide
            console.log('%cðŸ“‹ KYC FLOW TESTING GUIDE', 'font-weight: bold; font-size: 14px; color: #10B981;');
            console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #10B981;');
            console.log('%cðŸ†• NEW USER FLOW (8 steps):', 'font-weight: bold; color: #0EA5E9;');
            console.log('   1. Click "Test as New User" button');
            console.log('   2. Document type â†’ Select any option â†’ Continue');
            console.log('   3. Upload front â†’ Click "Capture Photo" â†’ Auto-proceeds');
            console.log('   4. Upload back â†’ Click "Capture Photo" â†’ Auto-proceeds');
            console.log('   5. Selfie â†’ Click "Start Capture" â†’ Auto-proceeds');
            console.log('   6. Liveness â†’ Click "Start Capture" â†’ Auto-proceeds');
            console.log('   7. Compliance â†’ Auto-proceeds');
            console.log('   8. âœ… Success screen');
            console.log('');
            console.log('%câ™»ï¸ RETURNING USER FLOW (5 steps):', 'font-weight: bold; color: #10B981;');
            console.log('   1. Click "Test as Returning User" button');
            console.log('   2. Partner check â†’ Auto-proceeds');
            console.log('   3. Partner found â†’ Click Continue');
            console.log('   4. Quick liveness â†’ Click "Start Quick Check" â†’ Auto-proceeds');
            console.log('   5. Compliance â†’ Auto-proceeds');
            console.log('   6. âœ… Success screen (with Reusable KYC badge)');
            console.log('');
            console.log('%cðŸŽ² RANDOM FLOW (50% error / 50% success):', 'font-weight: bold; color: #F59E0B;');
            console.log('   Click "Start Verification" button');
            console.log('   â€¢ 50% chance â†’ Error screen');
            console.log('   â€¢ 50% chance â†’ Random flow (new or returning)');
            console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #10B981;');
        });

        // Testing helper functions - launch flows directly
        function testAsNewUser() {
            localStorage.removeItem('reusableKYCPartner');
            console.log('ðŸ†• Starting NEW USER flow (full KYC)');
            startVerificationFlow('new');
        }

        function testAsReturningUser() {
            localStorage.setItem('reusableKYCPartner', 'CryptoExchange');
            console.log('â™»ï¸ Starting RETURNING USER flow (quick liveness)');
            startVerificationFlow('returning');
        }

        function clearTestData() {
            localStorage.removeItem('reusableKYCPartner');
            localStorage.removeItem('kycStatus');
            localStorage.removeItem('kycLevel');
            localStorage.removeItem('kycVerifiedDate');
            localStorage.removeItem('reusableKYC');
            console.log('ðŸ—‘ï¸ Test data cleared');
            location.reload();
        }

        // Launch verification flow with detailed screens
        function startVerificationFlow(userType) {
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            
            const container = document.getElementById('kycFlowContainer') || createFlowContainer();
            container.style.display = 'block';
            
            if (userType === 'new') {
                showNewUserFlow();
            } else {
                showReturningUserFlow();
            }
        }

        function createFlowContainer() {
            const container = document.createElement('div');
            container.id = 'kycFlowContainer';
            container.style.cssText = 'display:none;';
            document.querySelector('.main-container').appendChild(container);
            return container;
        }

        // NEW USER FLOW (8 steps)
        function showNewUserFlow() {
            const steps = [
                { id: 1, title: 'Checking Partner Network', action: 'scan', desc: 'Searching for previous verifications...', next: () => newUserStep2() },
                { id: 2, title: 'Select Document Type', action: 'form', desc: 'Choose your ID document', next: () => newUserStep3() },
                { id: 3, title: 'Upload Document Front', action: 'upload', desc: 'Take a photo of the front side', next: () => newUserStep4() },
                { id: 4, title: 'Upload Document Back', action: 'upload', desc: 'Take a photo of the back side', next: () => newUserStep5() },
                { id: 5, title: 'Take Selfie', action: 'camera', desc: 'Position your face in the frame', next: () => newUserStep6() },
                { id: 6, title: 'Liveness Detection', action: 'camera', desc: 'Follow the on-screen instructions', next: () => newUserStep7() },
                { id: 7, title: 'Compliance Checks', action: 'scan', desc: 'Running AML and document validation...', next: () => showFinalStatus('success', false) },
            ];
            currentNewUserStep = 0;
            renderNewUserStep(steps[0]);
        }

        let currentNewUserStep = 0;
        function renderNewUserStep(step) {
            const container = document.getElementById('kycFlowContainer');
            container.innerHTML = `
                <div class="convert-card flow-card-animated" style="max-width: 650px; margin: 0 auto; padding: 2.5rem;">
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%); border-radius: 2rem; margin-bottom: 1rem;">
                            <div style="width: 8px; height: 8px; background: var(--impact-green); border-radius: 50%; animation: pulse 2s infinite;"></div>
                            <span style="font-size: 0.813rem; font-weight: 600; color: var(--impact-green); text-transform: uppercase; letter-spacing: 0.5px;">Full Verification</span>
                        </div>
                        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.75rem; background: linear-gradient(135deg, var(--stone-dark) 0%, var(--stone-medium) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${step.title}</h2>
                        <p style="color: var(--stone-medium); font-size: 1rem; line-height: 1.5;">${step.desc}</p>
                        <div style="margin-top: 1.25rem; display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.875rem; background: rgba(0,0,0,0.03); border-radius: 1rem;">
                            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--stone-medium);">Step ${step.id} of 7</span>
                        </div>
                    </div>
                    <div class="progress-shimmer" style="height: 6px; background: rgba(0,0,0,0.05); border-radius: 3px; margin-bottom: 2.5rem; position: relative;">
                        <div style="height: 100%; background: linear-gradient(90deg, var(--impact-green) 0%, #0EA5E9 100%); border-radius: 3px; width: ${(step.id/7)*100}%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);"></div>
                    </div>
                    ${renderStepContent(step)}
                </div>
            `;
            
            // Auto-proceed for camera steps (testing only)
            if (step.action === 'camera') {
                let countdown = 3;
                const countdownInterval = setInterval(() => {
                    countdown--;
                    const countdownEl = document.getElementById('autoClickCountdown');
                    if (countdownEl && countdown > 0) {
                        countdownEl.innerHTML = `â±ï¸ Auto-capturing in ${countdown}s...`;
                    } else if (countdownEl) {
                        countdownEl.innerHTML = `âœ¨ Capturing...`;
                        countdownEl.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(14, 165, 233, 0.15))';
                    }
                }, 1000);
                
                setTimeout(() => {
                    clearInterval(countdownInterval);
                    // Hide countdown
                    const countdownEl = document.getElementById('autoClickCountdown');
                    if (countdownEl) countdownEl.style.display = 'none';
                    
                    console.log('ðŸŽ¬ Auto-proceeding to capture (step ' + step.id + ')');
                    const nextFn = step.id === 5 ? 'newUserStep6' : 'newUserStep7';
                    captureLiveness(step.id, nextFn);
                }, 3000);
            }
        }

        // Global access for debugging
        window.debugAutoClick = function() {
            const btn = document.getElementById('captureLivenessBtn');
            console.log('Button found:', !!btn, btn);
            if (btn) btn.click();
        };

        function renderStepContent(step) {
            if (step.action === 'scan') {
                setTimeout(step.next, 1500);
                return '<div style="text-align: center; padding: 3rem 0;"><div class="loading-spinner"></div></div>';
            }
            if (step.action === 'form' && step.id === 2) {
                return `
                    <div style="display: grid; gap: 1.25rem;">
                        <label class="radio-option" onclick="selectDoc('passport')" style="cursor: pointer; padding: 1.5rem; border-radius: 1rem; transition: all 0.2s;">
                            <input type="radio" name="docType" value="passport" style="width: 20px; height: 20px; margin-right: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 1.063rem; margin-bottom: 0.375rem;">ðŸ›‚ Passport</div>
                                <div style="font-size: 0.938rem; color: var(--stone-medium); line-height: 1.4;">Most widely accepted internationally</div>
                            </div>
                        </label>
                        <label class="radio-option" onclick="selectDoc('id')" style="cursor: pointer; padding: 1.5rem; border-radius: 1rem; transition: all 0.2s;">
                            <input type="radio" name="docType" value="id" style="width: 20px; height: 20px; margin-right: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 1.063rem; margin-bottom: 0.375rem;">ðŸªª National ID Card</div>
                                <div style="font-size: 0.938rem; color: var(--stone-medium); line-height: 1.4;">Government-issued identification</div>
                            </div>
                        </label>
                        <label class="radio-option" onclick="selectDoc('license')" style="cursor: pointer; padding: 1.5rem; border-radius: 1rem; transition: all 0.2s;">
                            <input type="radio" name="docType" value="license" style="width: 20px; height: 20px; margin-right: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 1.063rem; margin-bottom: 0.375rem;">ðŸš— Driver's License</div>
                                <div style="font-size: 0.938rem; color: var(--stone-medium); line-height: 1.4;">Valid photo identification</div>
                            </div>
                        </label>
                        <button class="btn-primary" id="docTypeBtn" onclick="newUserStep3()" disabled style="margin-top: 0.5rem; padding: 1rem 2rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
                            Continue
                            <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-left: 0.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                            </svg>
                        </button>
                    </div>
                `;
            }
            if (step.action === 'upload') {
                const nextStep = step.id === 3 ? 'newUserStep4' : 'newUserStep5';
                const docSide = step.id === 3 ? 'front' : 'back';
                return `
                    <div style="text-align: center;" id="uploadContainer">
                        <div class="capture-frame" style="position: relative; border: 3px solid rgba(16, 185, 129, 0.3); border-radius: 1.5rem; padding: 0; margin-bottom: 2rem; background: #1a1a1a; overflow: hidden; aspect-ratio: 16/10; max-width: 500px; margin-left: auto; margin-right: auto;" id="uploadFrame">
                            <!-- Camera viewfinder mockup -->
                            <div style="position: absolute; inset: 0; background: radial-gradient(circle at center, rgba(0,0,0,0.3), rgba(0,0,0,0.7)); display: flex; align-items: center; justify-content: center;">
                                <!-- Document frame guide -->
                                <div style="width: 70%; height: 65%; border: 3px dashed rgba(16, 185, 129, 0.8); border-radius: 1rem; position: relative; background: rgba(16, 185, 129, 0.05); backdrop-filter: blur(4px);">
                                    <!-- Corner guides -->
                                    <div style="position: absolute; top: -3px; left: -3px; width: 24px; height: 24px; border-top: 4px solid var(--impact-green); border-left: 4px solid var(--impact-green); border-radius: 4px 0 0 0;"></div>
                                    <div style="position: absolute; top: -3px; right: -3px; width: 24px; height: 24px; border-top: 4px solid var(--impact-green); border-right: 4px solid var(--impact-green); border-radius: 0 4px 0 0;"></div>
                                    <div style="position: absolute; bottom: -3px; left: -3px; width: 24px; height: 24px; border-bottom: 4px solid var(--impact-green); border-left: 4px solid var(--impact-green); border-radius: 0 0 0 4px;"></div>
                                    <div style="position: absolute; bottom: -3px; right: -3px; width: 24px; height: 24px; border-bottom: 4px solid var(--impact-green); border-right: 4px solid var(--impact-green); border-radius: 0 0 4px 0;"></div>
                                    <!-- Center instruction -->
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; font-weight: 600; font-size: 0.875rem; text-shadow: 0 2px 8px rgba(0,0,0,0.5);">
                                        <div style="width: 64px; height: 64px; margin: 0 auto 0.75rem; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(8px);">
                                            <svg width="36" height="36" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                        </div>
                                        Align ${docSide} of document
                                    </div>
                                </div>
                            </div>
                            <!-- Status indicators -->
                            <div style="position: absolute; top: 1rem; left: 1rem; display: flex; gap: 0.5rem;">
                                <div style="width: 8px; height: 8px; background: var(--impact-green); border-radius: 50%; box-shadow: 0 0 12px var(--impact-green); animation: pulse 2s infinite;"></div>
                                <span style="font-size: 0.75rem; color: white; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">READY</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.75rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                All corners visible
                            </span>
                            <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                                Good lighting
                            </span>
                            <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                No glare
                            </span>
                        </div>
                        <button class="btn-primary" onclick="captureDocument(${step.id}, '${nextStep}')" style="padding: 1rem 2rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
                            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            Capture Photo
                        </button>
                    </div>
                `;
            }
            if (step.action === 'camera') {
                const nextStep = step.id === 5 ? 'newUserStep6' : 'newUserStep7';
                const isLiveness = step.id === 6;
                return `
                    <div style="text-align: center;" id="cameraContainer">
                        <div style="position: relative; width: 320px; height: 400px; margin: 0 auto 2rem; background: #1a1a1a; border-radius: 2rem; overflow: hidden; border: 3px solid rgba(16, 185, 129, 0.3); box-shadow: 0 12px 40px rgba(0,0,0,0.2);" id="cameraFrame">
                            <!-- Camera feed mockup -->
                            <div style="position: absolute; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.4), rgba(0,0,0,0.8)); display: flex; align-items: center; justify-content: center;">
                                <!-- Face oval guide -->
                                <div style="position: relative; width: 200px; height: 260px; border: 4px solid var(--impact-green); border-radius: 50%; background: rgba(16, 185, 129, 0.05); box-shadow: 0 0 40px rgba(16, 185, 129, 0.3), inset 0 0 60px rgba(16, 185, 129, 0.1);">
                                    <!-- Face guide illustration -->
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 80%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem;">
                                        <!-- Head silhouette using CSS -->
                                        <div style="width: 80px; height: 100px; background: rgba(255,255,255,0.15); border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; position: relative; backdrop-filter: blur(4px);">
                                            <!-- Eyes -->
                                            <div style="position: absolute; top: 35%; left: 25%; width: 8px; height: 8px; background: rgba(255,255,255,0.6); border-radius: 50%;"></div>
                                            <div style="position: absolute; top: 35%; right: 25%; width: 8px; height: 8px; background: rgba(255,255,255,0.6); border-radius: 50%;"></div>
                                            <!-- Nose -->
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translateX(-50%); width: 3px; height: 15px; background: rgba(255,255,255,0.3); border-radius: 2px;"></div>
                                            <!-- Mouth -->
                                            <div style="position: absolute; bottom: 25%; left: 50%; transform: translateX(-50%); width: 20px; height: 2px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                        </div>
                                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.8); font-weight: 600; text-align: center; text-shadow: 0 2px 8px rgba(0,0,0,0.5);">
                                            ${isLiveness ? 'Follow instructions' : 'Center your face'}
                                        </div>
                                    </div>
                                    <!-- Scan line animation -->
                                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, transparent, var(--impact-green), transparent); animation: scanLine 2s linear infinite;"></div>
                                </div>
                            </div>
                            <!-- Top status bar -->
                            <div style="position: absolute; top: 1rem; left: 1rem; right: 1rem; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <div style="width: 8px; height: 8px; background: var(--impact-green); border-radius: 50%; box-shadow: 0 0 12px var(--impact-green); animation: pulse 2s infinite;"></div>
                                    <span style="font-size: 0.75rem; color: white; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">READY</span>
                                </div>
                                <div style="padding: 0.25rem 0.625rem; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); border-radius: 0.5rem;">
                                    <span style="font-size: 0.75rem; color: white; font-weight: 600;">
                                        <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                        ${isLiveness ? 'LIVENESS' : 'SELFIE'}
                                    </span>
                                </div>
                            </div>
                            <!-- Bottom instruction panel -->
                            <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1.25rem; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); backdrop-filter: blur(8px);">
                                <div style="font-size: 0.813rem; color: white; font-weight: 600; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                                    ${isLiveness ? 'Smile â€¢ Blink â€¢ Turn head' : 'Look at camera â€¢ Remove glasses'}
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.75rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            ${isLiveness ? `
                                <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Smile
                                </span>
                                <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    Blink
                                </span>
                                <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                                    </svg>
                                    Turn head
                                </span>
                            ` : `
                                <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    Look straight
                                </span>
                                <span style="padding: 0.5rem 0.875rem; background: rgba(16, 185, 129, 0.1); color: var(--impact-green); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.25rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                                    </svg>
                                    No glasses
                                </span>
                            `}
                        </div>
                        <div id="autoClickCountdown" style="margin-top: 1rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; color: var(--impact-green); border: 1px solid rgba(16, 185, 129, 0.2);">
                            â±ï¸ Auto-capturing in 3s...
                        </div>
                        <div style="display: flex; gap: 0.75rem; margin-top: 1rem; justify-content: center;">
                            <button class="btn-primary" id="captureLivenessBtn" onclick="captureLiveness(${step.id}, '${nextStep}')" style="padding: 1rem 2rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
                                <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Capture Now
                            </button>
                            <button class="btn-secondary" onclick="${nextStep}()" style="padding: 1rem 1.5rem; font-size: 1rem; font-weight: 600;">
                                Next â†’
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        let selectedDocType = null;
        function selectDoc(type) {
            selectedDocType = type;
            document.getElementById('docTypeBtn').disabled = false;
        }

        // Capture document with mock preview
        function captureDocument(stepId, nextFn) {
            const frame = document.getElementById('uploadFrame');
            const container = document.getElementById('uploadContainer');
            
            // Hide button
            const btn = container.querySelector('button');
            if (btn) btn.style.display = 'none';
            
            // Show capturing state (centered)
            frame.innerHTML = '<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 2rem;"><div class="loading-spinner"></div><div style="margin-top: 1rem; font-size: 0.875rem; color: var(--stone-medium); font-weight: 600;">Capturing...</div></div>';
            
            setTimeout(() => {
                // Show captured preview - Apple style
                const docType = stepId === 3 ? 'front' : 'back';
                frame.style.background = 'linear-gradient(to bottom, rgba(16, 185, 129, 0.03) 0%, rgba(16, 185, 129, 0.08) 100%)';
                frame.style.borderColor = 'var(--impact-green)';
                frame.style.borderWidth = '3px';
                frame.style.borderStyle = 'solid';
                frame.style.boxShadow = '0 8px 32px rgba(16, 185, 129, 0.2), 0 0 0 8px rgba(16, 185, 129, 0.05)';
                frame.innerHTML = `
                    <div style="padding: 1.25rem 1rem; text-align: center; height: 100%;">
                        <!-- Success checkmark -->
                        <div style="width: 56px; height: 56px; background: var(--impact-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3); animation: checkmark 0.5s ease-out;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        
                        <!-- Heading -->
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--stone-dark); margin-bottom: 0.5rem; letter-spacing: -0.02em;">Photo Captured!</h3>
                        
                        <!-- File info -->
                        <div style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.375rem 0.75rem; background: white; border-radius: 0.625rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
                            <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="var(--stone-medium)" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span style="font-size: 0.75rem; font-weight: 600; color: var(--stone-medium);">passport_${docType}.jpg</span>
                        </div>
                        
                        <!-- Validation checks -->
                        <div style="display: grid; gap: 0.5rem; text-align: left; max-width: 240px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.625rem; background: white; border-radius: 0.625rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
                                <div style="width: 18px; height: 18px; background: rgba(16, 185, 129, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="var(--impact-green)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </div>
                                <span style="font-size: 0.813rem; font-weight: 500; color: var(--stone-dark);">All corners visible</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.625rem; background: white; border-radius: 0.625rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
                                <div style="width: 18px; height: 18px; background: rgba(16, 185, 129, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="var(--impact-green)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </div>
                                <span style="font-size: 0.813rem; font-weight: 500; color: var(--stone-dark);">Good lighting</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.625rem; background: white; border-radius: 0.625rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
                                <div style="width: 18px; height: 18px; background: rgba(16, 185, 129, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="var(--impact-green)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </div>
                                <span style="font-size: 0.813rem; font-weight: 500; color: var(--stone-dark);">Text readable</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Auto-proceed
                setTimeout(() => {
                    if (typeof window[nextFn] === 'function') {
                        window[nextFn]();
                    } else {
                        console.error('Function not found:', nextFn);
                    }
                }, 2000);
            }, 1000);
        }

        // Capture liveness with mock feedback
        function captureLiveness(stepId, nextFn) {
            const frame = document.getElementById('cameraFrame');
            const instructions = document.getElementById('cameraInstructions');
            const container = document.getElementById('cameraContainer');
            
            // Hide button and countdown
            const btn = container.querySelector('button');
            if (btn) btn.style.display = 'none';
            const countdown = document.getElementById('autoClickCountdown');
            if (countdown) countdown.style.display = 'none';
            
            // Show processing with centered spinner
            instructions.innerHTML = '<div style="font-weight: 600; color: var(--stone-medium); margin-top: 1rem;">Processing...</div>';
            frame.innerHTML = '<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.4), rgba(0,0,0,0.8));"><div class="loading-spinner"></div></div>';
            
            setTimeout(() => {
                // Show captured face image (sample)
                frame.style.borderColor = 'var(--impact-green)';
                frame.style.boxShadow = '0 12px 40px rgba(16, 185, 129, 0.3)';
                frame.innerHTML = `
                    <div style="position: absolute; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.3), rgba(0,0,0,0.7)); display: flex; align-items: center; justify-content: center;">
                        <!-- Sample face silhouette -->
                        <svg width="140" height="180" viewBox="0 0 140 180" fill="none" style="filter: drop-shadow(0 4px 12px rgba(16, 185, 129, 0.4));">
                            <!-- Head -->
                            <ellipse cx="70" cy="70" rx="45" ry="55" fill="rgba(16, 185, 129, 0.3)" stroke="var(--impact-green)" stroke-width="3"/>
                            <!-- Eyes -->
                            <circle cx="55" cy="60" r="4" fill="var(--impact-green)"/>
                            <circle cx="85" cy="60" r="4" fill="var(--impact-green)"/>
                            <!-- Nose -->
                            <path d="M70 70 L70 85" stroke="var(--impact-green)" stroke-width="2" stroke-linecap="round"/>
                            <!-- Mouth (smile) -->
                            <path d="M55 95 Q70 105 85 95" stroke="var(--impact-green)" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                            <!-- Checkmark overlay -->
                            <circle cx="110" cy="30" r="18" fill="var(--impact-green)"/>
                            <path d="M103 30 L108 35 L117 26" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                `;
                
                const checks = stepId === 5 
                    ? ['Face detected', 'Eyes open', 'Looking at camera', 'No mask detected']
                    : ['Smile detected', 'Blink detected', 'Head turn left', 'Head turn right'];
                
                instructions.innerHTML = `
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--impact-green); border-radius: 0.75rem; padding: 1rem; text-align: left; display: inline-block; margin-top: 0.5rem;">
                        ${checks.map(c => `<div style="font-size: 0.875rem; color: var(--impact-green); margin: 0.375rem 0; font-weight: 500;">âœ“ ${c}</div>`).join('')}
                    </div>
                    <div style="margin-top: 1rem; font-weight: 700; font-size: 1.063rem; color: var(--impact-green);">${stepId === 5 ? 'Selfie Captured!' : 'Liveness Verified!'}</div>
                `;
                
                // Auto-proceed after showing captured face
                setTimeout(() => {
                    if (typeof window[nextFn] === 'function') {
                        console.log('âœ… Proceeding to next step:', nextFn);
                        window[nextFn]();
                    } else {
                        console.error('âŒ Function not found:', nextFn);
                    }
                }, 2500);
            }, 1500);
        }

        function newUserStep2() { 
            console.log('â†’ Step 2: Document selection');
            renderNewUserStep({ id: 2, title: 'Select Document Type', action: 'form', desc: 'Choose your ID document', next: () => newUserStep3() }); 
        }
        function newUserStep3() { 
            console.log('â†’ Step 3: Upload front');
            renderNewUserStep({ id: 3, title: 'Upload Document Front', action: 'upload', desc: 'Take a photo of the front side', next: () => newUserStep4() }); 
        }
        function newUserStep4() { 
            console.log('â†’ Step 4: Upload back');
            renderNewUserStep({ id: 4, title: 'Upload Document Back', action: 'upload', desc: 'Take a photo of the back side', next: () => newUserStep5() }); 
        }
        function newUserStep5() { 
            console.log('â†’ Step 5: Selfie');
            renderNewUserStep({ id: 5, title: 'Take Selfie', action: 'camera', desc: 'Position your face in the frame', next: () => newUserStep6() }); 
        }
        function newUserStep6() { 
            console.log('â†’ Step 6: Liveness');
            renderNewUserStep({ id: 6, title: 'Liveness Detection', action: 'camera', desc: 'Follow the on-screen instructions', next: () => newUserStep7() }); 
        }
        function newUserStep7() { 
            console.log('â†’ Step 7: Compliance');
            renderNewUserStep({ id: 7, title: 'Compliance Checks', action: 'scan', desc: 'Running AML and document validation...', next: () => showFinalStatus('success', false) }); 
        }

        // RETURNING USER FLOW (5 steps)
        function showReturningUserFlow() {
            returningUserStep1();
        }

        function returningUserStep1() {
            const container = document.getElementById('kycFlowContainer');
            container.innerHTML = `
                <div class="convert-card flow-card-animated" style="max-width: 650px; margin: 0 auto; padding: 2.5rem;">
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(14, 165, 233, 0.15) 100%); border-radius: 2rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);">
                            <span style="font-size: 1.25rem; animation: pulse 2s infinite;">âš¡</span>
                            <span style="font-size: 0.813rem; font-weight: 700; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 0.5px;">Reusable KYC</span>
                        </div>
                        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.75rem; background: linear-gradient(135deg, var(--stone-dark) 0%, var(--stone-medium) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Checking Partner Network</h2>
                        <p style="color: var(--stone-medium); font-size: 1rem; line-height: 1.5;">Searching for previous verifications...</p>
                        <div style="margin-top: 1.25rem; display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.875rem; background: rgba(0,0,0,0.03); border-radius: 1rem;">
                            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--stone-medium);">Step 1 of 5</span>
                        </div>
                    </div>
                    <div class="progress-shimmer" style="height: 6px; background: rgba(0,0,0,0.05); border-radius: 3px; margin-bottom: 2.5rem; position: relative;">
                        <div style="height: 100%; background: linear-gradient(90deg, #10B981 0%, #0EA5E9 100%); border-radius: 3px; width: 20%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);"></div>
                    </div>
                    <div style="text-align: center; padding: 3rem 0;"><div class="loading-spinner"></div></div>
                </div>
            `;
            setTimeout(returningUserStep2, 1500);
        }

        function returningUserStep2() {
            const partner = localStorage.getItem('reusableKYCPartner') || 'Partner Platform';
            const container = document.getElementById('kycFlowContainer');
            container.innerHTML = `
                <div class="convert-card" style="max-width: 600px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 0.875rem; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; margin-bottom: 0.5rem;">
                            âš¡ REUSABLE KYC DETECTED
                        </div>
                        <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Previous Verification Found!</h2>
                        <p style="color: var(--stone-medium); font-size: 0.938rem;">You verified with <strong>${partner}</strong></p>
                        <div style="margin-top: 1rem; font-size: 0.813rem; color: var(--stone-medium);">Step 2 of 5</div>
                    </div>
                    <div style="height: 4px; background: rgba(0,0,0,0.05); border-radius: 2px; margin-bottom: 2rem;">
                        <div style="height: 100%; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); border-radius: 2px; width: 40%; transition: width 0.3s;"></div>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
                        <div style="font-weight: 600; margin-bottom: 1rem; color: var(--impact-green);">âœ¨ No document upload needed!</div>
                        <div style="font-size: 0.875rem; color: var(--stone-medium); line-height: 1.6;">
                            We'll use your verified data from ${partner}. You only need a quick liveness check to confirm your identity.
                        </div>
                    </div>
                    <div style="text-align: center;"><button class="btn-primary" onclick="returningUserStep3()" style="padding: 1rem 2.5rem;">Continue</button></div>
                </div>
            `;
        }

        function returningUserStep3() {
            const container = document.getElementById('kycFlowContainer');
            container.innerHTML = `
                <div class="convert-card" style="max-width: 600px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 0.875rem; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; margin-bottom: 0.5rem;">
                            âš¡ REUSABLE KYC DETECTED
                        </div>
                        <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Quick Liveness Check</h2>
                        <p style="color: var(--stone-medium); font-size: 0.938rem;">Look at the camera and follow instructions</p>
                        <div style="margin-top: 1rem; font-size: 0.813rem; color: var(--stone-medium);">Step 3 of 5</div>
                    </div>
                    <div style="height: 4px; background: rgba(0,0,0,0.05); border-radius: 2px; margin-bottom: 2rem;">
                        <div style="height: 100%; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); border-radius: 2px; width: 60%; transition: width 0.3s;"></div>
                    </div>
                    <div style="text-align: center;" id="returningLivenessContainer">
                        <div class="camera-frame" id="returningLivenessFrame" style="position: relative; width: 320px; height: 400px; background: #1a1a1a; border-radius: 1.5rem; margin: 0 auto 1.5rem; overflow: hidden; border: 2px solid rgba(255,255,255,0.1); box-shadow: 0 12px 40px rgba(0,0,0,0.4);">
                            <div style="position: absolute; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.4), rgba(0,0,0,0.8)); display: flex; align-items: center; justify-content: center;">
                                <!-- Face guide -->
                                <svg width="140" height="180" viewBox="0 0 140 180" fill="none" style="filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4));">
                                    <ellipse cx="70" cy="70" rx="45" ry="55" fill="rgba(255,255,255,0.1)" stroke="rgba(16, 185, 129, 0.5)" stroke-width="3"/>
                                    <circle cx="55" cy="60" r="4" fill="rgba(255,255,255,0.5)"/>
                                    <circle cx="85" cy="60" r="4" fill="rgba(255,255,255,0.5)"/>
                                    <path d="M70 70 L70 85" stroke="rgba(255,255,255,0.5)" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M55 95 Q70 105 85 95" stroke="rgba(255,255,255,0.5)" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                                </svg>
                            </div>
                            <!-- Top status bar -->
                            <div style="position: absolute; top: 0; left: 0; right: 0; padding: 0.875rem 1rem; background: linear-gradient(180deg, rgba(0,0,0,0.7), transparent); display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.9); font-weight: 700; letter-spacing: 0.5px;">âš¡ QUICK CHECK</span>
                                <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--impact-green); box-shadow: 0 0 8px var(--impact-green);"></div>
                            </div>
                            <!-- Bottom instruction -->
                            <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1rem; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); text-align: center;">
                                <div style="font-size: 0.813rem; color: rgba(255,255,255,0.9); font-weight: 600; margin-bottom: 0.25rem;">Position your face</div>
                                <div style="font-size: 0.688rem; color: rgba(255,255,255,0.6);" id="returningLivenessInstructions">Smile â€¢ Blink â€¢ Turn head</div>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="captureReturningLiveness()" style="padding: 1rem 2.5rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
                            <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="vertical-align: middle; margin-right: 0.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Start Quick Check
                        </button>
                    </div>
                </div>
            `;
        }

        function captureReturningLiveness() {
            const frame = document.getElementById('returningLivenessFrame');
            const instructions = document.getElementById('returningLivenessInstructions');
            const container = document.getElementById('returningLivenessContainer');
            
            // Hide button
            container.querySelector('button').style.display = 'none';
            
            // Show processing (centered)
            instructions.innerHTML = 'Processing...';
            frame.innerHTML = `
                <div style="position: absolute; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.4), rgba(0,0,0,0.8)); display: flex; align-items: center; justify-content: center;">
                    <div class="loading-spinner"></div>
                </div>
                <div style="position: absolute; top: 0; left: 0; right: 0; padding: 0.875rem 1rem; background: linear-gradient(180deg, rgba(0,0,0,0.7), transparent); display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.75rem; color: rgba(255,255,255,0.9); font-weight: 700; letter-spacing: 0.5px;">âš¡ VERIFYING</span>
                    <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--impact-green); box-shadow: 0 0 8px var(--impact-green); animation: pulse 1s infinite;"></div>
                </div>
                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1rem; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); text-align: center;">
                    <div style="font-size: 0.813rem; color: rgba(255,255,255,0.9); font-weight: 600;">Processing...</div>
                </div>
            `;
            
            setTimeout(() => {
                // Show success
                frame.style.borderColor = 'var(--impact-green)';
                frame.style.boxShadow = '0 12px 40px rgba(16, 185, 129, 0.3), 0 0 0 4px rgba(16, 185, 129, 0.1)';
                frame.innerHTML = `
                    <div style="position: absolute; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(16, 185, 129, 0.1), rgba(0,0,0,0.8)); display: flex; align-items: center; justify-content: center;">
                        <svg width="140" height="180" viewBox="0 0 140 180" fill="none" style="filter: drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3));">
                            <ellipse cx="70" cy="70" rx="45" ry="55" fill="rgba(16, 185, 129, 0.2)" stroke="var(--impact-green)" stroke-width="3"/>
                            <circle cx="55" cy="60" r="4" fill="var(--impact-green)"/>
                            <circle cx="85" cy="60" r="4" fill="var(--impact-green)"/>
                            <path d="M70 70 L70 85" stroke="var(--impact-green)" stroke-width="2" stroke-linecap="round"/>
                            <path d="M55 95 Q70 105 85 95" stroke="var(--impact-green)" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                            <circle cx="105" cy="30" r="20" fill="var(--impact-green)"/>
                            <path d="M97 30 L103 36 L115 24" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div style="position: absolute; top: 0; left: 0; right: 0; padding: 0.875rem 1rem; background: linear-gradient(180deg, rgba(0,0,0,0.7), transparent); display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.75rem; color: rgba(255,255,255,0.9); font-weight: 700; letter-spacing: 0.5px;">âœ“ VERIFIED</span>
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--impact-green); box-shadow: 0 0 8px var(--impact-green);"></div>
                    </div>
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1rem; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); text-align: center;">
                        <div style="font-size: 0.813rem; color: rgba(255,255,255,0.9); font-weight: 600;">Liveness Verified!</div>
                    </div>
                `;
                
                instructions.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%); border: 1px solid var(--impact-green); border-radius: 0.75rem; padding: 1rem; text-align: left; display: inline-block; margin-top: 0.5rem;">
                        <div style="font-size: 0.875rem; color: var(--impact-green); margin: 0.375rem 0; font-weight: 500;">âœ“ Face match confirmed</div>
                        <div style="font-size: 0.875rem; color: var(--impact-green); margin: 0.375rem 0; font-weight: 500;">âœ“ Liveness verified</div>
                        <div style="font-size: 0.875rem; color: var(--impact-green); margin: 0.375rem 0; font-weight: 500;">âœ“ Using verified data from partner</div>
                    </div>
                    <div style="margin-top: 1rem; font-weight: 700; font-size: 1.063rem; color: var(--impact-green);">Quick Check Complete! âš¡</div>
                `;
                
                // Auto-proceed
                setTimeout(returningUserStep4, 1800);
            }, 1200);
        }

        function returningUserStep4() {
            const container = document.getElementById('kycFlowContainer');
            container.innerHTML = `
                <div class="convert-card" style="max-width: 600px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 0.875rem; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; margin-bottom: 0.5rem;">
                            âš¡ REUSABLE KYC DETECTED
                        </div>
                        <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Compliance Validation</h2>
                        <p style="color: var(--stone-medium); font-size: 0.938rem;">Using existing verified data from partner</p>
                        <div style="margin-top: 1rem; font-size: 0.813rem; color: var(--stone-medium);">Step 4 of 5</div>
                    </div>
                    <div style="height: 4px; background: rgba(0,0,0,0.05); border-radius: 2px; margin-bottom: 2rem;">
                        <div style="height: 100%; background: linear-gradient(135deg, #10B981 0%, #0EA5E9 100%); border-radius: 2px; width: 80%; transition: width 0.3s;"></div>
                    </div>
                    <div style="text-align: center; padding: 3rem 0;">
                        <div class="loading-spinner"></div>
                        <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--stone-medium);">Running compliance checks...</div>
                    </div>
                </div>
            `;
            setTimeout(() => showFinalStatus('success', true), 1500);
        }

        function showFinalStatus(status, isReturning) {
            const container = document.getElementById('kycFlowContainer');
            const verType = isReturning ? 'Quick Liveness Check âš¡' : 'Full Document Verification';
            const time = isReturning ? '~2 minutes' : '~5 minutes';
            const savings = isReturning ? '60% faster' : '';
            
            container.innerHTML = `
                <div class="convert-card flow-card-animated" style="max-width: 650px; margin: 0 auto; text-align: center; padding: 3rem 2.5rem;">
                    <div class="success-icon-animated" style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--impact-green) 0%, #0EA5E9 100%); border-radius: 50%; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3), 0 0 0 12px rgba(16, 185, 129, 0.1); position: relative;">
                        <svg width="56" height="56" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 13l4 4L19 7"/>
                        </svg>
                        ${isReturning ? '<div style="position: absolute; top: -8px; right: -8px; width: 40px; height: 40px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);">âš¡</div>' : ''}
                    </div>
                    <h1 style="font-size: 2.25rem; font-weight: 800; margin-bottom: 1rem; background: linear-gradient(135deg, var(--stone-dark) 0%, var(--impact-green) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Verification Complete!</h1>
                    <p style="color: var(--stone-medium); font-size: 1.063rem; line-height: 1.6; margin-bottom: 2.5rem; max-width: 480px; margin-left: auto; margin-right: auto;">
                        ${isReturning ? 'ðŸŽ‰ Verified using <strong style="color: var(--impact-green);">Reusable KYC</strong> â€” no documents needed!' : 'Your identity has been verified successfully. Welcome aboard!'}
                    </p>
                    ${isReturning ? `<div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%); border: 1.5px solid rgba(16, 185, 129, 0.3); border-radius: 1rem; padding: 1.25rem; margin-bottom: 2rem;">
                        <div style="font-size: 0.938rem; font-weight: 600; color: var(--impact-green); margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Time Saved: ${savings}
                        </div>
                        <div style="font-size: 0.875rem; color: var(--stone-medium);">Your previous verification with <strong>${localStorage.getItem('reusableKYCPartner')}</strong> made this instant!</div>
                    </div>` : ''}
                    <div style="background: linear-gradient(to bottom, rgba(0,0,0,0.02), rgba(0,0,0,0.04)); border-radius: 1rem; padding: 1.75rem; text-align: left; margin-bottom: 2rem; border: 1px solid rgba(0,0,0,0.06);">
                        <div style="display: grid; gap: 1rem; font-size: 0.938rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--stone-medium); font-weight: 500;">Status</span>
                                <span style="font-weight: 700; color: var(--impact-green); display: flex; align-items: center; gap: 0.375rem;">
                                    <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Verified
                                </span>
                            </div>
                            <div style="height: 1px; background: rgba(0,0,0,0.06);"></div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--stone-medium); font-weight: 500;">Verification Type</span>
                                <span style="font-weight: 600;">${verType}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--stone-medium); font-weight: 500;">Completion Time</span>
                                <span style="font-weight: 600;">${time}</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <a href="dashboard-enhanced.html" class="btn-primary" style="flex: 1; min-width: 200px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 1.125rem 2rem; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.25);">
                            Go to Dashboard
                            <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                            </svg>
                        </a>
                        <button class="btn-secondary" onclick="location.reload()" style="flex: 1; min-width: 200px; padding: 1.125rem 2rem; font-size: 1rem; font-weight: 600;">
                            <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.375rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Try Again
                        </button>
                    </div>
                </div>
            `;
            
            if (status === 'success') {
                localStorage.setItem('kycStatus', 'verified');
                localStorage.setItem('kycLevel', 'tier1');
            }
        }
    </script>
</body>
</html>
